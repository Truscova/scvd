{
  "doc_id": "sigmaprime_adex_review",
  "source_pdf": "review.pdf",
  "source_mtime": "2025-11-10T12:08:24+00:00",
  "extracted_at": "2025-11-12T02:04:48.733506+00:00",
  "extractor_version": "poc-0.4",
  "repositories": [
    {
      "url": "https://github.com/AdExNetwork/adex-protocol",
      "org": "AdExNetwork",
      "repo": "adex-protocol",
      "commit": null,
      "evidence": {
        "page": 2,
        "snippet": "This review focused on AdEx's payment channel implementation named [OUTPACE](https://github.com/AdExNetwork/adex-protocol/blob/master/OUTPACE.md) via AdExCore , libraries ChannelLibrary , SignatureVal..."
      }
    },
    {
      "url": "https://github.com/AdExNetwork/adex-protocol-eth",
      "org": "AdExNetwork",
      "repo": "adex-protocol-eth",
      "commit": "98c65a3e05262638e3ff2da28b873b7f7ca44982",
      "evidence": {
        "page": 4,
        "snippet": "This review was initially conducted on commit [98c65a3,](https://github.com/AdExNetwork/adex-protocol-eth/commit/98c65a3e05262638e3ff2da28b873b7f7ca44982) which contains the contracts folder. This fol..."
      }
    },
    {
      "url": "https://github.com/AdExNetwork/adex-protocol-eth",
      "org": "AdExNetwork",
      "repo": "adex-protocol-eth",
      "commit": "caa872ce982cd09a342b42d10281bf82038e6070",
      "evidence": {
        "page": 4,
        "snippet": "Retesting activities targeted commit [caa872c.](https://github.com/AdExNetwork/adex-protocol-eth/commit/caa872ce982cd09a342b42d10281bf82038e6070)"
      }
    },
    {
      "url": "https://github.com/trailofbits/rattle",
      "org": "trailofbits",
      "repo": "rattle",
      "commit": null,
      "evidence": {
        "page": 4,
        "snippet": "- Rattle: <https://github.com/trailofbits/rattle>"
      }
    },
    {
      "url": "https://github.com/ConsenSys/mythril",
      "org": "ConsenSys",
      "repo": "mythril",
      "commit": null,
      "evidence": {
        "page": 4,
        "snippet": "- Mythril: <https://github.com/ConsenSys/mythril>"
      }
    },
    {
      "url": "https://github.com/trailofbits/slither",
      "org": "trailofbits",
      "repo": "slither",
      "commit": null,
      "evidence": {
        "page": 4,
        "snippet": "- Slither: <https://github.com/trailofbits/slither>"
      }
    },
    {
      "url": "https://github.com/ConsenSys/surya",
      "org": "ConsenSys",
      "repo": "surya",
      "commit": null,
      "evidence": {
        "page": 4,
        "snippet": "- Surya: <https://github.com/ConsenSys/surya>"
      }
    },
    {
      "url": "https://github.com/AdExNetwork/adex-protocol-eth",
      "org": "AdExNetwork",
      "repo": "adex-protocol-eth",
      "commit": "da725ba15a77712cd8b5d175097114432d920174",
      "evidence": {
        "page": 10,
        "snippet": "- **Gas Saving** In ChannelLibrary.sol on lines [**9**] and [**10**], a uint8 is used. The EVM prefers type sizes of 32 bits (i.e. uint256 ). In order to read/write smaller types the EVM uses masks wh..."
      }
    },
    {
      "url": "https://github.com/AdExNetwork/adex-protocol-eth",
      "org": "AdExNetwork",
      "repo": "adex-protocol-eth",
      "commit": "46a8e48ec2817e1b0f6b333a0f075d8a318e6761",
      "evidence": {
        "page": 10,
        "snippet": "- **Gas Saving For-loop Convention** In MerkleProof.sol line [8], the for-loop terminates when i!=proof.length . It may be better to terminate the for-loop as of i < proof.length for better readabilit..."
      }
    },
    {
      "url": "https://github.com/ethereum/EIPs",
      "org": "ethereum",
      "repo": "EIPs",
      "commit": null,
      "evidence": {
        "page": 14,
        "snippet": "- <span id=\"page-14-1\"></span>[1] ERC-20 Token Standard. Github, Available: [https://github.com/ethereum/EIPs/blob/master/EIPS/](https://github.com/ethereum/EIPs/blob/master/EIPS/eip-20.md) [eip-20.md..."
      }
    }
  ],
  "report_schema": [
    {
      "key": "Severity",
      "meaning": "How serious the impact of this finding is.",
      "expected_values": "Informational / Low / Medium / High"
    },
    {
      "key": "Difficulty",
      "meaning": "How hard it is to exploit this issue.",
      "expected_values": "Low / Medium / High"
    },
    {
      "key": "Asset",
      "meaning": "The file or contract associated with the finding.",
      "expected_values": "path to affected file / contract"
    },
    {
      "key": "Status",
      "meaning": "The current status of the finding (e.g., open, closed).",
      "expected_values": "Closed: See Resolution / Open"
    },
    {
      "key": "Rating",
      "meaning": "The severity rating of the finding.",
      "expected_values": "Informational / Low / Medium / High"
    },
    {
      "key": "Finding ID",
      "meaning": "A unique identifier for the finding.",
      "expected_values": "ADX-01, ADX-02, etc."
    },
    {
      "key": "Target",
      "meaning": "The specific target or component affected by the finding.",
      "expected_values": "contract name / function"
    }
  ],
  "vulnerability_sections": [
    {
      "index": 1,
      "page_start": 7,
      "heading": "1. Tokens Can Be Locked if Channel Creators Lose Their Keys",
      "markdown": "| ADX-01 | Tokens Can Be Locked if Channel Creators Lose Their Keys |\n|--------|----------------------------------------------------------|\n| Asset  | AdExCore.sol                                             |\n| Status | Closed: See Resolution                                   |\n| Rating | Informational                                            |\n\nIn the event that a channel becomes stale and cannot update/progress its state (for example, the *supermajority* cannot be reached, or more than <sup>1</sup> 3 lose their keys or fail to participate) the tokens can only be withdrawn once the channel expires. In such an event, only the channel creator can withdraw the original deposited tokens.\n\nIt can be the case that a creator creates a channel and disposes or loses the related private key over time, not expecting to have to withdraw the channel's tokens. In this scenario, tokens are lost forever in the AdExCore contract.\n\nThis is simply an informational point and may be the intentional design of the related smart contract.\n\n#### **Recommendations**\n\nA safety mechanism could be easily implemented which allows anyone to withdraw lost tokens using a timeoutbased approach. For example, on line [**55**] the require could be modified as follows:\n\n```\nrequire ( msg . sender == channel . creator || now > channel . validUntil + 1 year );\n```\n\n## **Resolution**\n\nThe development team acknowledges this issue, see below response:\n\n*\"After review, we decided to pass on implementing the recommendation, since it constitutes unintuitive behavior for us; the recommendation would allow anyone to claim the tokens after a period; in terms of decision making, this is the same debate as whether lost coins should be \"recycled\" from bitcoin/ethereum. In our protocol papers, we mention that using an arbitor validator is a helpful, since if one of them loses the keys, the channel can still be drained\".*\n",
      "finding_id": "ADX-01",
      "description": "In the event that a channel becomes stale and cannot update/progress its state (for example, the *supermajority* cannot be reached, or more than <sup>1</sup> 3 lose their keys or fail to participate) the tokens can only be withdrawn once the channel expires. In such an event, only the channel creator can withdraw the original deposited tokens.\n\nIt can be the case that a creator creates a channel and disposes or loses the related private key over time, not expecting to have to withdraw the channel's tokens. In this scenario, tokens are lost forever in the AdExCore contract.\n\nThis is simply an informational point and may be the intentional design of the related smart contract.\n",
      "metadata": {
        "Severity": "Low",
        "Difficulty": "Low",
        "Asset": "AdExCore.sol",
        "Status": "Closed: See Resolution",
        "Rating": "Informational",
        "Finding ID": "ADX-01",
        "Target": "channel creator"
      },
      "heading_cleaned": "Tokens Can Be Locked if Channel Creators Lose Their Keys"
    },
    {
      "index": 2,
      "page_start": 8,
      "heading": "2. Publishers Unable to Withdraw from Fast Expiring Channels",
      "markdown": "| ADX-02 | Publishers Unable to Withdraw from Fast Expiring Channels |\n|--------|-----------------------------------------------------------|\n| Asset  | ChannelLibrary.sol                                        |\n| Status | Closed: See Resolution                                    |\n| Rating | Informational                                             |\n\nThe AdEx Protocol documentation states [\\[2\\]](#page-14-2), *\"OUTPACE channel should have 2-3 times as long of a duration, in order to allow extra time for publishers to withdraw their revenue.\"*\n\nHowever, in the current core implementation, there is no minimum time requirement for each channel's validUntil duration. Thus, publishers have to rely on the *Market* (a RESTful service) to compute and communicate all time constraints. This Market layer cannot be entirely trusted.\n\nAssuming the time interval is erroneously communicated to publishers, or simply not accounted for by publishers, there exists a realistic edge case where channels expire before publishers are able to withdraw earned revenues.\n\nSimilarly, a malicious advertiser can also create a channel with a small active time window, with just enough time for publishers to confirm a bid, but not enough time to allow payment withdrawal. After the channel expires, the advertiser is able to withdraw the remaining balance without paying publishers.\n\n#### **Recommendations**\n\nAdEx acknowledges this potential **stuck revenue** problem. The current implementation suggests publishers will reliably check for expiration times off-chain and will account for this potential issue.\n\nAnother recommendation is to impose a reasonable MIN\\_VALIDITY time interval (as a constant in ChannelLibrary ) for each channel upon channel creation. This constant could be used to restrict channels to have minimum lengths.\n\n#### **Resolution**\n\nThe development team acknowledges this issue, see below response:\n\n*\"Again, we consider this to be a defined behavior, although we will consider implementing the recommendation of a minimum channel duration. However, as with many things in the AdEx ecosystem (token used, who are the validators) this is one of the things that will be governed on-chain: short lived channels would be excluded/filtered\".*\n",
      "finding_id": "ADX-02",
      "description": "The AdEx Protocol documentation states [\\[2\\]](#page-14-2), *\"OUTPACE channel should have 2-3 times as long of a duration, in order to allow extra time for publishers to withdraw their revenue.\"*\n\nHowever, in the current core implementation, there is no minimum time requirement for each channel's validUntil duration. Thus, publishers have to rely on the *Market* (a RESTful service) to compute and communicate all time constraints. This Market layer cannot be entirely trusted.\n\nAssuming the time interval is erroneously communicated to publishers, or simply not accounted for by publishers, there exists a realistic edge case where channels expire before publishers are able to withdraw earned revenues.\n\nSimilarly, a malicious advertiser can also create a channel with a small active time window, with just enough time for publishers to confirm a bid, but not enough time to allow payment withdrawal. After the channel expires, the advertiser is able to withdraw the remaining balance without paying publishers.\n",
      "metadata": {
        "Severity": "Informational",
        "Difficulty": "High",
        "Asset": "ChannelLibrary.sol",
        "Status": "Closed: See Resolution",
        "Rating": "Informational",
        "Finding ID": "ADX-02",
        "Target": "Publishers Unable to Withdraw from Fast Expiring Channels"
      },
      "heading_cleaned": "Publishers Unable to Withdraw from Fast Expiring Channels"
    },
    {
      "index": 3,
      "page_start": 9,
      "heading": "3. Inadequate and Misleading On-chain Channel State",
      "markdown": "| ADX-03 | Inadequate and Misleading On-chain Channel State |\n|--------|--------------------------------------------------|\n| Asset  | ChannelLibrary.sol                               |\n| Status | Closed: See Resolution                           |\n| Rating | Informational                                    |\n\nThe AdEx Protocol documentation specifies that [\\[2\\]](#page-14-2): *\"the market needs to track all on-chain OUTPACE channels and needs to constantly monitor their liveness (>=2/3 validators online and producing new states) and state.\"*.\n\nFurthermore, the AdexCore maintains a public states mapping that signals whether channels are Unknown , Active , or Expired .\n\nCurrent design and implementation seem to permit clumsy providers or market-builders to mistake states for a reliable source of channel *state*. It is possible that users will rely on the getChannelState getter function to read this information on-chain and see if the channel has expired.\n\nThis is problematic since the states mapping does not accurately describe the latest actual channel state. For example, the only way for a channel state to become Expired is if the advertiser withdraws their balance upon channel expiry. Expired channels, whose advertisers have not yet withdrawn, will show up as Active in the related on-chain states .\n\n#### **Recommendations**\n\nA getter function could be implemented, which would leverage the isValid() function on Active states with the current blocktime to return a more accurate description of whether a channel's state is truly active and valid.\n\n#### **Resolution**\n\nThe development team acknowledges this issue, see below response:\n\n*\"We acknowledge this issue and it's a very good point, however we think it's an issue of naming. There is a separate system to track the overall channel state (the validator stack), which is also aware of campaign health and whether all funds in the channel are distributed (Exchausted state) that takes care of that. Our internal recommendation would be to rename the state getter\".*\n",
      "finding_id": "ADX-03",
      "description": "The AdEx Protocol documentation specifies that [\\[2\\]](#page-14-2): *\"the market needs to track all on-chain OUTPACE channels and needs to constantly monitor their liveness (>=2/3 validators online and producing new states) and state.\"*.\n\nFurthermore, the AdexCore maintains a public states mapping that signals whether channels are Unknown , Active , or Expired .\n\nCurrent design and implementation seem to permit clumsy providers or market-builders to mistake states for a reliable source of channel *state*. It is possible that users will rely on the getChannelState getter function to read this information on-chain and see if the channel has expired.\n\nThis is problematic since the states mapping does not accurately describe the latest actual channel state. For example, the only way for a channel state to become Expired is if the advertiser withdraws their balance upon channel expiry. Expired channels, whose advertisers have not yet withdrawn, will show up as Active in the related on-chain states .\n",
      "metadata": {
        "Severity": "Medium",
        "Difficulty": "Low",
        "Asset": "ChannelLibrary.sol",
        "Status": "Closed: See Resolution",
        "Rating": "Informational",
        "Finding ID": "ADX-03",
        "Target": "Channel state tracking system"
      },
      "heading_cleaned": "Inadequate and Misleading On-chain Channel State"
    },
    {
      "index": 4,
      "page_start": 10,
      "heading": "4. Miscellanenous Comments and Gas Optimisation Suggestions",
      "markdown": "| ADX-04 | Miscellanenous Comments and Gas Optimisation Suggestions |\n|--------|----------------------------------------------------------|\n| Asset  | All Contracts in Scope                                   |\n| Status | Resolved: See inline comments and Resolution             |\n| Rating | Informational                                            |\n\nThis section outlines miscellaneous comments and suggestions that were found as a by-product of this review. We include this section as it may be useful for the authors to improve readability of the code.\n\n- **Gas Saving** In ChannelLibrary.sol on lines [**9**] and [**10**], a uint8 is used. The EVM prefers type sizes of 32 bits (i.e. uint256 ). In order to read/write smaller types the EVM uses masks which costs more gas. Setting these to uint types will reduce computation and save gas. ✓ Resolved in commit [\\[da725ba\\]](https://github.com/AdExNetwork/adex-protocol-eth/commit/da725ba15a77712cd8b5d175097114432d920174)\n- **Gas Saving For-loop Convention** In MerkleProof.sol line [8], the for-loop terminates when i!=proof.length . It may be better to terminate the for-loop as of i < proof.length for better readability. This would also save gas, as the EVM takes one additional opcode to perform a \"not equals\" check than it takes to perform a \"less than\" check. ✓ Resolved in commit [\\[46a8e48\\]](https://github.com/AdExNetwork/adex-protocol-eth/commit/46a8e48ec2817e1b0f6b333a0f075d8a318e6761)\n- **Gas Saving Public Functions** In AdExCore.sol , the following functions can be declared external instead of public to save gas: channelOpen , channelWithdraw and channelWithdrawExpired .\n- **Comment Inaccuracy** In MerkleProof.sol line [7], developer comment notes the future need to *\"compare valueHash == root if the proof is empty?\"*. This is not necessary as this base case is already handled by the function. A merkle tree with only 1 leaf uses the leaf as the root itself. ✓ Resolved in commit [\\[caa872c\\]](https://github.com/AdExNetwork/adex-protocol-eth/commit/caa872ce982cd09a342b42d10281bf82038e6070)\n- **Comment Inaccuracy** In SafeERC20.sol line [10], developer comment suggests the checkSuccess() function is *\"definitely not a pure fn but the compiler complains otherwise\"*. This function is indeed a pure function as the assembly doesn't include any impure opcode (see a non-exhaustive list [\\[3\\]](#page-14-3)). ✓ Resolved in commit [\\[caa872c\\]](https://github.com/AdExNetwork/adex-protocol-eth/commit/caa872ce982cd09a342b42d10281bf82038e6070)\n\n### **Recommendations**\n\nEnsure these are as expected.\n\n#### **Resolution**\n\nThe items listed above have been resolved, with the exception of the \"Gas Saving - Public Functions\". See related response below from the development team:\n\n*\"Everything addressed in latest master except \"gas saving - public functions\". Using \"external\" causes various types of issues related to the new ABIEncoderv2 within the solidity/ethereum ecosystem; the most prominent one we encountered was the C++ version of solc v0.4.25 crashing with a segfault when the functions are external; this has not*\n\n\n\n*happened ever since we simplified a particular function signature, but still, truffle test fails with an obscure solc JS error when we try to change it now; should be investigated further\".*\n",
      "finding_id": "ADX-04",
      "description": "This section outlines miscellaneous comments and suggestions that were found as a by-product of this review. We include this section as it may be useful for the authors to improve readability of the code.\n\n- **Gas Saving** In ChannelLibrary.sol on lines [**9**] and [**10**], a uint8 is used. The EVM prefers type sizes of 32 bits (i.e. uint256 ). In order to read/write smaller types the EVM uses masks which costs more gas. Setting these to uint types will reduce computation and save gas. ✓ Resolved in commit [\\[da725ba\\]](https://github.com/AdExNetwork/adex-protocol-eth/commit/da725ba15a77712cd8b5d175097114432d920174)\n- **Gas Saving For-loop Convention** In MerkleProof.sol line [8], the for-loop terminates when i!=proof.length . It may be better to terminate the for-loop as of i < proof.length for better readability. This would also save gas, as the EVM takes one additional opcode to perform a \"not equals\" check than it takes to perform a \"less than\" check. ✓ Resolved in commit [\\[46a8e48\\]](https://github.com/AdExNetwork/adex-protocol-eth/commit/46a8e48ec2817e1b0f6b333a0f075d8a318e6761)\n- **Gas Saving Public Functions** In AdExCore.sol , the following functions can be declared external instead of public to save gas: channelOpen , channelWithdraw and channelWithdrawExpired .\n- **Comment Inaccuracy** In MerkleProof.sol line [7], developer comment notes the future need to *\"compare valueHash == root if the proof is empty?\"*. This is not necessary as this base case is already handled by the function. A merkle tree with only 1 leaf uses the leaf as the root itself. ✓ Resolved in commit [\\[caa872c\\]](https://github.com/AdExNetwork/adex-protocol-eth/commit/caa872ce982cd09a342b42d10281bf82038e6070)\n- **Comment Inaccuracy** In SafeERC20.sol line [10], developer comment suggests the checkSuccess() function is *\"definitely not a pure fn but the compiler complains otherwise\"*. This function is indeed a pure function as the assembly doesn't include any impure opcode (see a non-exhaustive list [\\[3\\]](#page-14-3)). ✓ Resolved in commit [\\[caa872c\\]](https://github.com/AdExNetwork/adex-protocol-eth/commit/caa872ce982cd09a342b42d10281bf82038e6070)\n",
      "metadata": {
        "Severity": "Informational",
        "Difficulty": "Low",
        "Asset": "All Contracts in Scope",
        "Status": "Resolved: See inline comments and Resolution",
        "Rating": "Informational",
        "Finding ID": "ADX-04",
        "Target": "All Contracts in Scope"
      },
      "heading_cleaned": "Miscellanenous Comments and Gas Optimisation Suggestions"
    }
  ]
}